"use strict";var ye=Object.create;var B=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var Ee=(e,t)=>{for(var i in t)B(e,i,{get:t[i],enumerable:!0})},Z=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!he.call(e,o)&&o!==i&&B(e,o,{get:()=>t[o],enumerable:!(r=be(t,o))||r.enumerable});return e};var _=(e,t,i)=>(i=e!=null?ye(xe(e)):{},Z(t||!e||!e.__esModule?B(i,"default",{value:e,enumerable:!0}):i,e)),we=e=>Z(B({},"__esModule",{value:!0}),e);var Fe={};Ee(Fe,{confirmation:()=>Oe,default:()=>me});module.exports=we(Fe);var b=_(require("path")),w=_(require("fs")),O=_(require("os"));var L=_(require("fs")),S=_(require("os")),Q=require("@raycast/api");var ee=_(require("util")),te=require("child_process"),E=ee.default.promisify(te.exec);async function C(e){try{let{stdout:t}=await E(`"${e}" -version`),i=t.match(/ffmpeg version (\d+)\.(\d+)/);if(i){let r=parseInt(i[1],10),o=parseInt(i[2],10);return r+o/10}return null}catch(t){return console.error("Error checking FFmpeg version:",t),null}}async function N(e=6){try{let i=(0,Q.getPreferenceValues)().ffmpeg_path;if(i&&i.trim()&&L.default.existsSync(i)){let a=await C(i);if(a&&a>=e)return await Q.LocalStorage.setItem("ffmpeg-path",i),console.log(`Found custom FFmpeg at: ${i} with version: ${a}`),{path:i,version:a}}let r=await Q.LocalStorage.getItem("ffmpeg-path");if(r&&typeof r=="string"&&L.default.existsSync(r)){let a=await C(r);if(a&&a>=e)return{path:r,version:a}}let o=S.default.platform(),n=[];if(o==="darwin")n.push("/usr/local/bin/ffmpeg","/opt/homebrew/bin/ffmpeg","/usr/bin/ffmpeg","/opt/local/bin/ffmpeg","/nix/store/*/bin/ffmpeg",`${S.default.homedir()}/.nix-profile/bin/ffmpeg`,"/run/current-system/sw/bin/ffmpeg",`${S.default.homedir()}/miniconda3/bin/ffmpeg`,`${S.default.homedir()}/anaconda3/bin/ffmpeg`,`${S.default.homedir()}/mambaforge/bin/ffmpeg`,"/usr/local/miniconda3/bin/ffmpeg","/usr/local/anaconda3/bin/ffmpeg","/sw/bin/ffmpeg","/Applications/ffmpeg","/Applications/FFmpeg/ffmpeg",`${S.default.homedir()}/bin/ffmpeg`,`${S.default.homedir()}/.local/bin/ffmpeg`,"/usr/pkg/bin/ffmpeg");else if(o==="win32"){let a=process.env.ProgramFiles||"C:\\Program Files",p=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)",c=process.env.USERPROFILE||"C:\\Users\\%USERNAME%",m=process.env.LOCALAPPDATA||`${c}\\AppData\\Local`;n.push(`${a}\\ffmpeg\\bin\\ffmpeg.exe`,`${p}\\ffmpeg\\bin\\ffmpeg.exe`,"C:\\ffmpeg\\bin\\ffmpeg.exe",`${a}\\ffmpeg\\ffmpeg.exe`,"C:\\ProgramData\\chocolatey\\lib\\ffmpeg\\tools\\ffmpeg\\bin\\ffmpeg.exe","C:\\tools\\ffmpeg\\bin\\ffmpeg.exe",`${c}\\scoop\\apps\\ffmpeg\\current\\bin\\ffmpeg.exe`,`${c}\\scoop\\shims\\ffmpeg.exe`,`${m}\\Microsoft\\WinGet\\Packages\\Gyan.FFmpeg_Microsoft.Winget.Source_*\\ffmpeg-*\\bin\\ffmpeg.exe`,`${c}\\miniconda3\\Scripts\\ffmpeg.exe`,`${c}\\anaconda3\\Scripts\\ffmpeg.exe`,`${c}\\mambaforge\\Scripts\\ffmpeg.exe`,"C:\\ProgramData\\Miniconda3\\Scripts\\ffmpeg.exe","C:\\ProgramData\\Anaconda3\\Scripts\\ffmpeg.exe","C:\\msys64\\usr\\bin\\ffmpeg.exe","C:\\msys64\\mingw64\\bin\\ffmpeg.exe","C:\\msys64\\mingw32\\bin\\ffmpeg.exe",`${c}\\bin\\ffmpeg.exe`,`${c}\\Tools\\ffmpeg\\bin\\ffmpeg.exe`,`${m}\\Programs\\ffmpeg\\bin\\ffmpeg.exe`)}else{let a=S.default.homedir();n.push("/usr/bin/ffmpeg","/usr/local/bin/ffmpeg","/bin/ffmpeg","/snap/bin/ffmpeg","/var/lib/snapd/snap/bin/ffmpeg","/var/lib/flatpak/exports/bin/org.ffmpeg.FFmpeg",`${a}/.local/share/flatpak/exports/bin/org.ffmpeg.FFmpeg`,`${a}/Applications/ffmpeg.AppImage`,`${a}/.local/bin/ffmpeg.AppImage`,"/nix/store/*/bin/ffmpeg",`${a}/.nix-profile/bin/ffmpeg`,"/run/current-system/sw/bin/ffmpeg",`${a}/miniconda3/bin/ffmpeg`,`${a}/anaconda3/bin/ffmpeg`,`${a}/mambaforge/bin/ffmpeg`,"/opt/miniconda3/bin/ffmpeg","/opt/anaconda3/bin/ffmpeg",`${a}/bin/ffmpeg`,`${a}/.local/bin/ffmpeg`,"/opt/ffmpeg/bin/ffmpeg","/usr/local/ffmpeg/bin/ffmpeg",`${a}/ffmpeg/ffmpeg`,`${a}/src/ffmpeg/ffmpeg`,"/opt/local/bin/ffmpeg")}for(let a of n)if(L.default.existsSync(a)){let p=await C(a);if(p&&p>=e)return await Q.LocalStorage.setItem("ffmpeg-path",a),console.log(`Found FFmpeg at: ${a} with version: ${p}`),{path:a,version:p}}return null}catch(t){return console.error("Error finding valid FFmpeg:",t),null}}var ie=[".mov",".mp4",".avi",".mkv",".mpg",".webm",".ts",".mpeg",".vob",".m2ts",".mts",".m4v",".flv",".3gp",".asf",".wmv",".rmvb",".ogv",".mxf",".nut",".dv",".gxf",".rm",".cdxl",".wtv",".m3u8",".mpd",".seg",".txd"],oe=[".jpg",".jpeg",".png",".webp",".heic",".tiff",".tif",".avif",".bmp",".pcx",".tga",".ras",".sgi",".ppm",".pgm",".pbm",".pnm",".xbm",".xpm",".ico",".jp2",".j2k",".pcd",".cin",".wbmp",".xface"],ne=[".mp3",".aac",".wav",".m4a",".flac",".aif",".aiff",".ogg",".oga",".alac",".wma",".opus",".amr",".caf",".au",".snd",".ape",".dsf",".dff",".mpc",".wv",".spx",".xa",".ra"],$e=[".mp4",".avi",".mov",".mkv",".mpg",".webm"],_e=[".mp3",".aac",".wav",".flac",".m4a"],Se=[".jpg",".png",".webp",".heic",".tiff",".avif"],Je=[...ie,...oe,...ne],Ze=[...$e,..._e,...Se],q=["64","96","128","160","192","224","256","320"],j=["22050","44100","48000","96000"],ae=["16","24","32"],re=["aac_low","aac_he","aac_he_v2"],se=["0","1","2","3","4","5","6","7","8"],G=["crf","vbr","vbr-2-pass"],pe={".mp4":[{encodingMode:"crf",crf:75,preset:"medium"},{encodingMode:"vbr",bitrate:"2000",maxBitrate:"",preset:"medium"},{encodingMode:"vbr-2-pass",bitrate:"2000",maxBitrate:"",preset:"medium"}],".avi":[{encodingMode:"vbr",bitrate:"2000",maxBitrate:""},{encodingMode:"vbr-2-pass",bitrate:"2000",maxBitrate:""}],".mov":[{variant:"standard"}],".mkv":[{encodingMode:"crf",crf:75,preset:"medium"},{encodingMode:"vbr",bitrate:"2000",maxBitrate:"",preset:"medium"},{encodingMode:"vbr-2-pass",bitrate:"2000",maxBitrate:"",preset:"medium"}],".mpg":[{encodingMode:"crf",crf:75},{encodingMode:"vbr",bitrate:"2000",maxBitrate:""},{encodingMode:"vbr-2-pass",bitrate:"2000",maxBitrate:""}],".webm":[{encodingMode:"crf",crf:60,quality:"good"},{encodingMode:"vbr",bitrate:"2000",maxBitrate:"",quality:"good"},{encodingMode:"vbr-2-pass",bitrate:"2000",maxBitrate:"",quality:"good"}]},Ae=Object.fromEntries(Object.entries(pe).map(([e,t])=>[e,t.map(i=>typeof i=="object"&&"encodingMode"in i?i.encodingMode:null).filter(i=>i!==null)])),Me=["50000","40000","30000","25000","20000","15000","10000","8000","5000","4000","3000","2000","1500","1000","750","500"],et=["",...Me];var Pe=["4444xq","4444","hq","standard","lt","proxy"];function ce(e,t,i){let r=pe[e]??[];if(e===".mov"){let f=i&&typeof i=="object"&&"variant"in i?i.variant:r[0]?.variant??Pe[0];return{variant:t&&t.variant||f}}let o=Ae[e]??G,n=i&&typeof i=="object"&&"encodingMode"in i?i.encodingMode:void 0,a=n&&o.includes(n)?n:o[0]??"crf",p=t&&t.encodingMode&&o.includes(t.encodingMode)?t.encodingMode:a,c=r.find(f=>f.encodingMode===p)??r[0]??{};if(p==="crf"){let f=t&&typeof t.crf=="number"?t.crf:c.crf??(i&&i.crf),h=t&&t.preset?t.preset:c.preset??(i&&i.preset);return{encodingMode:"crf",crf:f,...h?{preset:h}:{}}}let m=t&&t.bitrate?t.bitrate:c.bitrate??(i&&i.bitrate),s=t&&t.maxBitrate?t.maxBitrate:c.maxBitrate??(i&&i.maxBitrate),l=t&&t.preset?t.preset:c.preset??(i&&i.preset),y=t&&t.quality?t.quality:c.quality??(i&&i.quality),d={encodingMode:p};return m&&(d.bitrate=m),s!==void 0&&(d.maxBitrate=s),l&&(d.preset=l),y&&(d.quality=y),d}var H={".mp3":{lowest:{bitrate:"96",vbr:!1},low:{bitrate:"128",vbr:!1},medium:{bitrate:"192",vbr:!0},high:{bitrate:"256",vbr:!0},highest:{bitrate:"320",vbr:!0}},".aac":{lowest:{bitrate:"96",profile:"aac_low"},low:{bitrate:"128",profile:"aac_low"},medium:{bitrate:"192",profile:"aac_low"},high:{bitrate:"256",profile:"aac_low"},highest:{bitrate:"320",profile:"aac_low"}},".m4a":{lowest:{bitrate:"96",profile:"aac_low"},low:{bitrate:"128",profile:"aac_low"},medium:{bitrate:"192",profile:"aac_low"},high:{bitrate:"256",profile:"aac_low"},highest:{bitrate:"320",profile:"aac_low"}},".wav":{lowest:{sampleRate:"22050",bitDepth:"16"},low:{sampleRate:"44100",bitDepth:"16"},medium:{sampleRate:"44100",bitDepth:"16"},high:{sampleRate:"48000",bitDepth:"24"},highest:{sampleRate:"96000",bitDepth:"24"}},".flac":{lowest:{compressionLevel:"8",sampleRate:"44100",bitDepth:"16"},low:{compressionLevel:"5",sampleRate:"44100",bitDepth:"16"},medium:{compressionLevel:"5",sampleRate:"44100",bitDepth:"16"},high:{compressionLevel:"3",sampleRate:"48000",bitDepth:"24"},highest:{compressionLevel:"0",sampleRate:"96000",bitDepth:"24"}},".mp4":{lowest:{encodingMode:"crf",crf:30,preset:"fast"},low:{encodingMode:"crf",crf:50,preset:"medium"},medium:{encodingMode:"crf",crf:75,preset:"medium"},high:{encodingMode:"crf",crf:85,preset:"slow"},highest:{encodingMode:"crf",crf:95,preset:"slower"}},".avi":{lowest:{encodingMode:"vbr",bitrate:"1000",maxBitrate:""},low:{encodingMode:"vbr",bitrate:"1500",maxBitrate:""},medium:{encodingMode:"vbr",bitrate:"2000",maxBitrate:""},high:{encodingMode:"vbr",bitrate:"3000",maxBitrate:""},highest:{encodingMode:"vbr",bitrate:"5000",maxBitrate:""}},".mov":{lowest:{variant:"proxy"},low:{variant:"lt"},medium:{variant:"standard"},high:{variant:"hq"},highest:{variant:"4444"}},".mkv":{lowest:{encodingMode:"crf",crf:30,preset:"fast"},low:{encodingMode:"crf",crf:50,preset:"medium"},medium:{encodingMode:"crf",crf:75,preset:"medium"},high:{encodingMode:"crf",crf:85,preset:"slow"},highest:{encodingMode:"crf",crf:95,preset:"slower"}},".mpg":{lowest:{encodingMode:"crf",crf:30},low:{encodingMode:"crf",crf:50},medium:{encodingMode:"crf",crf:75},high:{encodingMode:"crf",crf:85},highest:{encodingMode:"crf",crf:95}},".webm":{lowest:{encodingMode:"crf",crf:30,quality:"realtime"},low:{encodingMode:"crf",crf:50,quality:"good"},medium:{encodingMode:"crf",crf:60,quality:"good"},high:{encodingMode:"crf",crf:75,quality:"good"},highest:{encodingMode:"crf",crf:90,quality:"best"}}};var le={".jpg":80,".png":"png-24",".webp":80,".heic":80,".tiff":"deflate",".avif":80,".mp3":{bitrate:"192",vbr:!0},".aac":{bitrate:"192",profile:"aac_low"},".m4a":{bitrate:"192",profile:"aac_low"},".wav":{sampleRate:"44100",bitDepth:"16"},".flac":{compressionLevel:"5",sampleRate:"44100",bitDepth:"16"},".mp4":{encodingMode:"crf",crf:75,preset:"medium"},".avi":{encodingMode:"vbr",bitrate:"2000",maxBitrate:""},".mov":{variant:"standard"},".mkv":{encodingMode:"crf",crf:75,preset:"medium"},".mpg":{encodingMode:"crf",crf:75},".webm":{encodingMode:"crf",crf:60,quality:"good"}};function V(e){return e=e.toLowerCase(),oe.includes(e)?"image":ne.includes(e)?"audio":ie.includes(e)?"video":null}function Qe(e){return Math.round(51-e/100*51)}function X(e,t){let i=e.replace(b.default.extname(e),t),r=i,o=1;for(;w.default.existsSync(r);){let n=b.default.basename(i,t),a=b.default.dirname(i);r=b.default.join(a,`${n}(${o})${t}`),o++}return r}async function U(e,t,i,r=!1){let o=await N();if(!o)throw new Error("FFmpeg is not installed or configured. Please install FFmpeg to use this converter.");let n=`"${o.path}" -i`;switch(V(b.default.extname(e))){case"image":{let p=t,c=i,m=X(e,p),s=null,l=null,y=b.default.extname(e).toLowerCase(),d=e;try{if(p===".heic"){let f=`sips --setProperty format heic --setProperty formatOptions ${c[".heic"]} "${e}" --out "${m}"`;if(r)return f;try{await E(f)}catch(h){let R=String(h);throw R.includes("command not found")||R.includes("not recognized")?new Error("HEIC conversion failed: 'sips' command not found. Converting to HEIC format is theoretically only available on macOS, as it requires the built-in SIPS utility with proper HEIC support (libheif, libde265, and x265 dependencies)."):new Error("HEIC conversion failed: SIPS command found but conversion unsuccessful. This may indicate that your SIPS installation lacks proper HEIC support. Converting to HEIC format typically requires macOS with built-in SIPS that includes libheif, libde265, and x265 dependencies. Error details: "+String(h))}}else{if(y===".heic")if(r)d=e;else try{let f=`${b.default.basename(e,".heic")}_temp_${Date.now()}.png`;s=b.default.join(O.default.tmpdir(),f),await E(`sips --setProperty format png "${e}" --out "${s}"`),d=s}catch(f){throw console.error(`Error pre-processing HEIC file: ${e}`,f),s&&w.default.existsSync(s)&&w.default.unlinkSync(s),new Error(`Failed to preprocess HEIC file: ${String(f)}`)}switch(n+=` "${d}"`,p){case".jpg":n+=` -q:v ${Math.round(31-c[".jpg"]/100*29)}`;break;case".png":if(c[".png"]==="png-8")if(r){let f=`${b.default.basename(e,b.default.extname(e))}_palette.png`;l=b.default.join(O.default.tmpdir(),f);let h=`"${o.path}" -i "${d}" -vf "palettegen=max_colors=256" -y "${l}"`;return n=`"${o.path}" -i "${d}" -i "${l}" -lavfi "paletteuse=dither=bayer:bayer_scale=5" -compression_level 100 -y "${m}"`,`${h}
${n}`}else{let f=`${b.default.basename(e,b.default.extname(e))}_palette_${Date.now()}.png`;l=b.default.join(O.default.tmpdir(),f),await E(`"${o.path}" -i "${d}" -vf "palettegen=max_colors=256" -y "${l}"`),n=`"${o.path}" -i "${d}" -i "${l}" -lavfi "paletteuse=dither=bayer:bayer_scale=5"`}(!r||c[".png"]!=="png-8")&&(n+=" -compression_level 100");break;case".webp":n+=" -c:v libwebp",c[".webp"]==="lossless"?n+=" -lossless 1":n+=` -quality ${c[".webp"]}`;break;case".tiff":n+=` -compression_algo ${c[".tiff"]}`;break;case".avif":n+=` -c:v libaom-av1 -crf ${Math.round(63-Number(c[".avif"])/100*63)} -still-picture 1`;break}if(p!==".png"||c[".png"]!=="png-8"?n+=` -y "${m}"`:n+=` "${m}"`,r)return n;console.log(`Executing FFmpeg image command: ${n}`),await E(n)}return m}catch(f){throw console.error(`Error converting ${d} to ${p}:`,f),f}finally{s&&w.default.existsSync(s)&&w.default.unlinkSync(s),l&&w.default.existsSync(l)&&w.default.unlinkSync(l)}}case"audio":{let p=t,c=i,m=X(e,p);switch(n+=` "${e}"`,p){case".mp3":{let s=c[".mp3"];n+=" -c:a libmp3lame",s.vbr?n+=` -q:a ${Math.round((320-Number(s.bitrate))/40)}`:n+=` -b:a ${s.bitrate}k`;break}case".aac":{let s=c[".aac"];n+=` -c:a aac -b:a ${s.bitrate}k`,s.profile&&(n+=` -profile:a ${s.profile}`);break}case".m4a":{let s=c[".m4a"];n+=` -c:a aac -b:a ${s.bitrate}k`,s.profile&&(n+=` -profile:a ${s.profile}`);break}case".wav":{let s=c[".wav"];n+=` -c:a pcm_s${s.bitDepth}le -ar ${s.sampleRate}`;break}case".flac":{let s=c[".flac"];n+=` -c:a flac -compression_level ${s.compressionLevel} -ar ${s.sampleRate}`,s.bitDepth==="24"&&(n+=" -sample_fmt s32");break}default:throw new Error(`Unknown audio output format: ${p}`)}return n+=` -y "${m}"`,r?n:(console.log(`Executing FFmpeg audio command: ${n}`),await E(n),m)}case"video":{let p=t,c=i;switch(n+=` "${e}"`,p){case".mp4":{let l=c[".mp4"];n+=` -vcodec h264 -acodec aac -preset ${l.preset}`;break}case".avi":{n+=" -vcodec libxvid -acodec mp3";break}case".mov":{let l=c[".mov"];n+=` -vcodec prores -profile:v ${{proxy:"0",lt:"1",standard:"2",hq:"3",4444:"4","4444xq":"5"}[l.variant]} -acodec pcm_s16le`;break}case".mkv":{let l=c[".mkv"];n+=` -vcodec libx265 -acodec aac -preset ${l.preset}`;break}case".mpg":{n+=" -vcodec mpeg2video -acodec mp3";break}case".webm":{let l=c[".webm"];n+=` -vcodec libvpx-vp9 -acodec libopus -quality ${l.quality}`;break}default:throw new Error(`Unknown video output format: ${p}`)}p!==".mov"&&(n+=" -pix_fmt yuv420p");let m=X(e,p),s=null;if(p!==".mov"){let l=c[p];if("encodingMode"in l){if(l.encodingMode==="crf")n+=` -crf ${Qe(l.crf)}`;else if(n+=` -b:v ${l.bitrate}k`,"maxBitrate"in l&&l.maxBitrate&&(n+=` -maxrate ${l.maxBitrate}k -bufsize ${Number(l.maxBitrate)*2}k`),l.encodingMode==="vbr-2-pass")if(r){s=b.default.join(O.default.tmpdir(),`ffmpeg2pass_${Date.now()}`);let y=process.platform==="win32"?"NUL":"/dev/null",d=n+` -pass 1 -passlogfile "${s}" -f null ${y}`,f=n+` -pass 2 -passlogfile "${s}" -y "${m}"`;return`${d}
${f}`}else{s=b.default.join(O.default.tmpdir(),`ffmpeg2pass_${Date.now()}`);let y=process.platform==="win32"?"NUL":"/dev/null",d=n+` -pass 1 -passlogfile "${s}" -f null ${y}`;try{await E(d)}catch(f){throw new Error(`First pass encoding failed: ${f}`)}n+=` -pass 2 -passlogfile "${s}"`}}}try{return n+=` -y "${m}"`,r?n:(console.log(`Executing FFmpeg video command: ${n}`),await E(n),m)}finally{if(s)try{let l=[`${s}-0.log`,`${s}-0.log.mbtree`,`${s}-0.log.temp`,`${s}-1.log`,`${s}-1.log.mbtree`,`${s}-1.log.temp`];for(let y of l)if(w.default.existsSync(y))try{w.default.unlinkSync(y)}catch(d){console.warn(`Failed to clean up log file ${y}:`,d)}}catch(l){console.warn("Failed to clean up FFmpeg log files:",l)}}}default:throw new Error(`Unsupported media type for file: ${e}`)}}var F=_(require("path")),ue=_(require("os")),fe=_(require("fs"));async function de(e){if(!e)throw new Error("Input path is required but was not provided.");let t=F.default.resolve(F.default.normalize(e.replace(/^~/,ue.default.homedir())));if(!fe.default.existsSync(t))throw new Error(`The file does not exist at ${t}`);return t}async function me(e){let{inputPath:t,outputFileType:i,quality:r,imageQualityPercent:o,webpLossless:n,pngVariant:a,tiffCompression:p,audioBitrate:c,audioVbr:m,audioProfile:s,audioSampleRate:l,audioBitDepth:y,flacCompressionLevel:d,videoEncodingMode:f,videoCrf:h,videoBitrate:R,videoMaxBitrate:Y,videoPreset:z,proresVariant:W,vp9Quality:K}=e;if(!await N())return{type:"error",message:"FFmpeg is not installed. Please install FFmpeg to use this tool."};let M,v;try{if(M=await de(t),v=V(F.default.extname(M)),!v)return{type:"error",message:`Unsupported input file type for path: ${M}`}}catch(I){return{type:"error",message:String(I)}}try{let I,D=(()=>{let P=le[i];if(v==="image"){let $=P,g=$;switch(i){case".jpg":{let u=T(o);g=typeof u=="number"?u:$;break}case".png":{g=a&&["png-24","png-8"].includes(a)?a:$;break}case".webp":{if(n)g="lossless";else{let u=T(o);g=typeof u=="number"?u:$}break}case".heic":{if(process.platform!=="darwin")throw new Error("HEIC output is only supported on macOS.");let u=T(o);g=typeof u=="number"?u:$;break}case".tiff":{g=p&&["deflate","lzw"].includes(p)?p:$;break}case".avif":{let u=T(o);g=typeof u=="number"?u:$;break}}return{[i]:g}}if(v==="audio"){let g=c||typeof m=="boolean"||s||l||y||d?P:r?H[i]?.[r]??P:P;switch(i){case".mp3":{let u=g;g={bitrate:A(c,q,u.bitrate),vbr:typeof m=="boolean"?m:u.vbr};break}case".aac":case".m4a":{let u=g,x=u.profile??"aac_low";g={bitrate:A(c,q,u.bitrate),profile:A(s,re,x)};break}case".wav":{let u=g;g={sampleRate:A(l,j,u.sampleRate),bitDepth:A(y,ae,u.bitDepth)};break}case".flac":{let u=g,x=A(y??u.bitDepth,["16","24"],u.bitDepth);y==="32"&&(x="24"),g={compressionLevel:A(d,se,u.compressionLevel),sampleRate:A(l,j,u.sampleRate),bitDepth:x};break}}return{[i]:g}}if(v==="video"){let g=f||typeof h=="number"||R||typeof Y=="string"||z||W||K?P:r?H[i]?.[r]??P:P,u=g,x={encodingMode:f,crf:T(h),bitrate:R,maxBitrate:Y,preset:z,quality:K,variant:W};return g=ce(i,x,u),{[i]:g}}throw new Error("Unsupported media type for quality building")})();if(v==="image")I=await U(M,i,D);else if(v==="audio")I=await U(M,i,D);else if(v==="video")I=await U(M,i,D);else return{type:"error",message:`Cannot convert ${v} to ${i}. Invalid conversion pair.`};let ge=Te(v,i,D);return{type:"success",message:`\u2705 Converted ${v} to ${i}
- Input: ${M}
- Output: ${I}
- Settings: ${ge}`}}catch(I){return console.error(I),{type:"error",message:`\u274C The ${v} could not be converted. Error: ${I}`}}}var Oe=async e=>{try{let t=await de(e.inputPath),i=V(F.default.extname(t)),r="This will create a new file in the same directory.",o=[{name:"Input Path",value:t},{name:"Input Media Type",value:i||"Unknown"},{name:"Output File Type",value:e.outputFileType}];e.quality&&o.push({name:"Quality (simple)",value:String(e.quality)});let n=ke(e);return n&&o.push({name:"Advanced",value:n}),{message:r,info:o}}catch(t){return{message:String(t),info:[]}}};function T(e){if(!(typeof e!="number"||Number.isNaN(e)))return Math.min(100,Math.max(0,Math.round(e)))}function k(e){if(typeof e!="object"||e===null)return;let t=e.encodingMode;if(typeof t=="string"&&G.includes(t))return t}function Re(e){return typeof e=="object"&&e!==null&&typeof e.crf=="number"}function Ve(e){return typeof e=="object"&&e!==null&&typeof e.bitrate=="string"}function A(e,t,i){return e!==void 0&&t.includes(e)?e:i}function Te(e,t,i){if(e==="image"){let r=i;switch(t){case".jpg":return`quality ${r[".jpg"]}%`;case".heic":return`quality ${r[".heic"]}%`;case".avif":return`quality ${r[".avif"]}%`;case".webp":{let o=r[".webp"];return typeof o=="string"?"lossless":`quality ${o}%`}case".png":return`variant ${r[".png"]}`;case".tiff":return`compression ${r[".tiff"]}`}}if(e==="audio"){let r=i;switch(t){case".mp3":{let o=r[".mp3"];return`bitrate ${o.bitrate} kbps${o.vbr?", VBR":""}`}case".aac":{let o=r[".aac"];return`bitrate ${o.bitrate} kbps${o.profile?`, profile ${o.profile}`:""}`}case".m4a":{let o=r[".m4a"];return`bitrate ${o.bitrate} kbps${o.profile?`, profile ${o.profile}`:""}`}case".wav":{let o=r[".wav"];return`${o.sampleRate} Hz, ${o.bitDepth}-bit`}case".flac":{let o=r[".flac"];return`level ${o.compressionLevel}, ${o.sampleRate} Hz, ${o.bitDepth}-bit`}}}if(e==="video"){let r=i;switch(t){case".mov":return`ProRes ${r[".mov"].variant}`;case".webm":{let o=r[".webm"],n=k(o);if(n==="crf"){let p=o;return`CRF ${p.crf}, VP9 ${p.quality}`}let a=o;return`${(n??"").toUpperCase()} ${a.bitrate} kbps${a.maxBitrate?` max ${a.maxBitrate}`:""}, VP9 ${a.quality}`}case".mp4":{let o=r[".mp4"],n=k(o);if(n==="crf"){let p=o;return`CRF ${p.crf}, preset ${p.preset}`}let a=o;return`${(n??"").toUpperCase()} ${a.bitrate} kbps${a.maxBitrate?` max ${a.maxBitrate}`:""}, preset ${a.preset}`}case".mkv":{let o=r[".mkv"],n=k(o);if(n==="crf"){let p=o;return`CRF ${p.crf}, preset ${p.preset}`}let a=o;return`${(n??"").toUpperCase()} ${a.bitrate} kbps${a.maxBitrate?` max ${a.maxBitrate}`:""}, preset ${a.preset}`}case".avi":{let o=r[".avi"];return Re(o)?`CRF ${o.crf}`:Ve(o)?`${(k(o)??"").toUpperCase()} ${o.bitrate} kbps${o.maxBitrate?` max ${o.maxBitrate}`:""}`:"default"}case".mpg":{let o=r[".mpg"],n=k(o);if(n==="crf")return`CRF ${o.crf}`;let a=o;return`${(n??"").toUpperCase()} ${a.bitrate} kbps${a.maxBitrate?` max ${a.maxBitrate}`:""}`}}}return"default"}function ke(e){let t=[];return typeof e.imageQualityPercent=="number"&&t.push(`imageQuality ${e.imageQualityPercent}%`),e.webpLossless&&t.push("webp lossless"),e.pngVariant&&t.push(`png ${e.pngVariant}`),e.tiffCompression&&t.push(`tiff ${e.tiffCompression}`),e.audioBitrate&&t.push(`audio bitrate ${e.audioBitrate}`),typeof e.audioVbr=="boolean"&&t.push(`audio vbr ${e.audioVbr?"on":"off"}`),e.audioProfile&&t.push(`audio profile ${e.audioProfile}`),e.audioSampleRate&&t.push(`audio sample ${e.audioSampleRate}`),e.audioBitDepth&&t.push(`audio bitDepth ${e.audioBitDepth}`),e.flacCompressionLevel&&t.push(`flac level ${e.flacCompressionLevel}`),e.videoEncodingMode&&t.push(`video mode ${e.videoEncodingMode}`),typeof e.videoCrf=="number"&&t.push(`video crf ${e.videoCrf}`),e.videoBitrate&&t.push(`video bitrate ${e.videoBitrate}`),typeof e.videoMaxBitrate=="string"&&t.push(`video maxBitrate ${e.videoMaxBitrate||"none"}`),e.videoPreset&&t.push(`video preset ${e.videoPreset}`),e.proresVariant&&t.push(`prores ${e.proresVariant}`),e.vp9Quality&&t.push(`vp9 ${e.vp9Quality}`),t.join(", ")}0&&(module.exports={confirmation});
